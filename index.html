<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Turnos de Limpieza</title>
  <style>
    :root {
      color-scheme: dark;
      font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
      --bg: #0f172a;
      --bg-card: rgba(15, 23, 42, 0.92);
      --bg-input: rgba(30, 41, 59, 0.75);
      --bg-input-focus: rgba(51, 65, 85, 0.85);
      --fg: #e2e8f0;
      --fg-muted: #94a3b8;
      --accent: #38bdf8;
      --accent-strong: #0ea5e9;
      --success: #34d399;
      --error: #f87171;
      --warning: #fbbf24;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px 16px;
      background: radial-gradient(circle at top, #1e293b, #020617 70%);
      color: var(--fg);
    }

    .app {
      width: min(420px, 94vw);
      padding: 32px 28px 36px;
      border-radius: 24px;
      background: var(--bg-card);
      box-shadow: 0 20px 50px rgba(2, 6, 23, 0.55);
      border: 1px solid rgba(148, 163, 184, 0.12);
      backdrop-filter: blur(14px);
    }

    h1 {
      font-size: clamp(1.9rem, 4vw, 2.3rem);
      margin: 0 0 0.4rem;
      color: #f8fafc;
      letter-spacing: -0.01em;
    }

    .subtitle {
      margin: 0 0 1.8rem;
      color: var(--fg-muted);
      font-size: 0.98rem;
      line-height: 1.4;
    }

    label {
      font-weight: 600;
      font-size: 0.95rem;
      color: #f1f5f9;
      letter-spacing: 0.01em;
    }

    input[type="date"] {
      width: 100%;
      border: 1px solid transparent;
      border-radius: 14px;
      padding: 13px 15px;
      font-size: 0.98rem;
      color: var(--fg);
      background: var(--bg-input);
      transition: border-color 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
    }

    input[type="date"]:focus {
      outline: none;
      border-color: rgba(56, 189, 248, 0.65);
      background: var(--bg-input-focus);
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.28);
    }

    small {
      color: var(--fg-muted);
      line-height: 1.4;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.14);
      font-size: 0.78rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--fg-muted);
    }

    .pill.accent {
      background: rgba(56, 189, 248, 0.16);
      color: #bae6fd;
    }

    .summary {
      margin-top: 12px;
      padding: 20px 20px 24px;
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.18);
      background: rgba(30, 41, 59, 0.62);
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .summary p {
      margin: 0;
      font-size: 0.98rem;
      color: var(--fg);
    }

    .anchor-editor {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }

    .anchor-editor input[type="date"] {
      width: 100%;
      background: rgba(15, 23, 42, 0.75);
    }

    .people-selector {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 8px;
    }

    .people-button {
      border: 1px solid rgba(148, 163, 184, 0.3);
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(15, 23, 42, 0.65);
      color: #e2e8f0;
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.01em;
      cursor: pointer;
      transition: background 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
    }

    .people-button[aria-selected="true"] {
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.2), rgba(14, 165, 233, 0.38));
      border-color: rgba(56, 189, 248, 0.65);
      color: #f8fafc;
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(14, 165, 233, 0.25);
    }

    .people-button:focus-visible {
      outline: 2px solid rgba(56, 189, 248, 0.85);
      outline-offset: 3px;
    }

    .checkin {
      margin-top: 24px;
      padding: 22px 20px;
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.18);
      background: rgba(15, 23, 42, 0.72);
      backdrop-filter: blur(12px);
      display: none;
    }

    .checkin[aria-hidden="false"] {
      display: block;
    }

    .checkin-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 14px;
    }

    .checkin-title {
      font-size: 1.02rem;
      font-weight: 600;
      color: #f8fafc;
    }

    .checkin-subtitle {
      font-size: 0.88rem;
      color: var(--fg-muted);
    }

    .checkin-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .checkin-item {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 12px;
      align-items: center;
      padding: 12px 14px;
      border-radius: 14px;
      background: rgba(30, 41, 59, 0.58);
      border: 1px solid rgba(148, 163, 184, 0.12);
    }

    .checkin-item input[type="checkbox"] {
      width: 22px;
      height: 22px;
      accent-color: var(--accent-strong);
      cursor: pointer;
    }

    .checkin-label {
      display: flex;
      flex-direction: column;
      gap: 4px;
      color: #e2e8f0;
    }

    .checkin-name {
      font-weight: 600;
      font-size: 0.98rem;
    }

    .checkin-task {
      font-size: 0.86rem;
      color: var(--fg-muted);
    }

    .checkin-meta {
      margin-top: 6px;
      font-size: 0.78rem;
      color: rgba(148, 163, 184, 0.8);
    }

    .checkin-meta time {
      color: #f8fafc;
    }

    @media (max-width: 480px) {
      .app {
        padding: 28px 22px 32px;
        border-radius: 20px;
      }

      .people-selector {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <h1>Turnos de limpieza</h1>
    <p class="subtitle">Consulta qué toca esta semana automáticamente con la fecha de hoy. Si necesitas ajustar el punto de partida, cambia la semana 1 anclada y marca el check-in cuando termines tu tarea.</p>

    <section id="resumen" class="summary" aria-live="polite">
      <div class="pill accent" id="resumen-semana"></div>
      <p id="resumen-fecha"></p>
      <p id="resumen-anchor"></p>

      <div class="anchor-editor">
        <label for="anchor">Cambiar semana 1 anclada</label>
        <input id="anchor" type="date" value="2025-09-29" />
      </div>

      <div class="people-selector" role="tablist" aria-label="Personas del piso">
        <button type="button" class="people-button" data-persona="Alberto" role="tab" aria-selected="true">Alberto</button>
        <button type="button" class="people-button" data-persona="Victor" role="tab" aria-selected="false">Victor</button>
        <button type="button" class="people-button" data-persona="Irene" role="tab" aria-selected="false">Irene</button>
        <button type="button" class="people-button" data-persona="Murci" role="tab" aria-selected="false">Murci</button>
      </div>

      <p id="resumen-tarea"></p>
    </section>

    <section id="checkin-panel" class="checkin" aria-hidden="true">
      <div class="checkin-header">
        <span class="checkin-title">Check-in semanal</span>
        <span class="checkin-subtitle" id="checkin-week-info"></span>
        <small>Marca la casilla cuando termines tu tarea. El estado queda guardado en este dispositivo para poder revisarlo después.</small>
      </div>
      <ul id="checkin-list" class="checkin-list"></ul>
    </section>
  </main>

  <script>
    const TAREAS = ["Salón", "Cocina", "Baños", "Libre"];
    const CUADRANTE = [
      ["Alberto", "Irene", "Victor", "Murci"],
      ["Murci", "Alberto", "Irene", "Victor"],
      ["Victor", "Murci", "Alberto", "Irene"],
      ["Irene", "Victor", "Murci", "Alberto"]
    ];

    const BASE_DATE_ISO = "2025-09-29";
    const STORAGE_PREFIX = "turnos-checkin::";
    const SELECTED_PERSON_KEY = `${STORAGE_PREFIX}selected-person`;
    const ANCHOR_STORAGE_KEY = `${STORAGE_PREFIX}anchor-base`;

    function norm(s) {
      return s
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .trim();
    }

    function semanasEntre(base, fecha) {
      const msSemana = 1000 * 60 * 60 * 24 * 7;
      return Math.floor((fecha - base) / msSemana);
    }

    function parseDateOrNull(value) {
      if (!value) return null;
      const parsed = new Date(value + "T00:00:00");
      return Number.isNaN(parsed.getTime()) ? null : parsed;
    }

    function getCheckinKey(baseIso, fechaIso) {
      return `${STORAGE_PREFIX}${baseIso}::${fechaIso}`;
    }

    function readCheckins(key) {
      try {
        const stored = localStorage.getItem(key);
        return stored ? JSON.parse(stored) : {};
      } catch (error) {
        console.warn("No se pudieron leer los check-in almacenados", error);
        return {};
      }
    }

    function writeCheckins(key, data) {
      try {
        localStorage.setItem(key, JSON.stringify(data));
      } catch (error) {
        console.warn("No se pudieron guardar los check-in", error);
      }
    }

    function getStoredAnchor() {
      try {
        return localStorage.getItem(ANCHOR_STORAGE_KEY) || BASE_DATE_ISO;
      } catch (error) {
        console.warn("No se pudo recuperar la semana anclada", error);
        return BASE_DATE_ISO;
      }
    }

    function storeAnchor(value) {
      try {
        localStorage.setItem(ANCHOR_STORAGE_KEY, value);
      } catch (error) {
        console.warn("No se pudo guardar la semana anclada", error);
      }
    }

    function getToday() {
      const now = new Date();
      return new Date(now.getFullYear(), now.getMonth(), now.getDate());
    }

    function capitalise(str) {
      return str ? str.charAt(0).toUpperCase() + str.slice(1) : str;
    }

    function formatDateTimeForHuman(date) {
      return date.toLocaleString("es-ES", {
        year: "numeric",
        month: "long",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit"
      });
    }

    function renderCheckinPanel(idxSemana, fechaIso, baseIso, fechaHumana) {
      const panel = document.getElementById("checkin-panel");
      const list = document.getElementById("checkin-list");
      const weekInfo = document.getElementById("checkin-week-info");
      const key = getCheckinKey(baseIso, fechaIso);
      const registros = readCheckins(key);

      list.innerHTML = "";
      weekInfo.textContent = `Ciclo semana ${idxSemana + 1} · ${fechaHumana}`;

      CUADRANTE[idxSemana].forEach((persona, index) => {
        const personaKey = norm(persona);
        const registro = registros[personaKey];
        const item = document.createElement("li");
        item.className = "checkin-item";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = `checkin-${personaKey}`;
        checkbox.checked = Boolean(registro?.done);

        checkbox.addEventListener("change", () => {
          const nuevoRegistro = {
            done: checkbox.checked,
            timestamp: checkbox.checked ? new Date().toISOString() : null
          };
          const actualizados = { ...readCheckins(key) };
          if (checkbox.checked) {
            actualizados[personaKey] = nuevoRegistro;
          } else {
            delete actualizados[personaKey];
          }
          writeCheckins(key, actualizados);
          renderCheckinPanel(idxSemana, fechaIso, baseIso, fechaHumana);
        });

        const label = document.createElement("label");
        label.className = "checkin-label";
        label.htmlFor = checkbox.id;

        const nombreSpan = document.createElement("span");
        nombreSpan.className = "checkin-name";
        nombreSpan.textContent = persona;

        const tareaSpan = document.createElement("span");
        tareaSpan.className = "checkin-task";
        tareaSpan.textContent = `Tarea: ${TAREAS[index]}`;

        label.append(nombreSpan, tareaSpan);

        if (registro?.timestamp) {
          const meta = document.createElement("div");
          meta.className = "checkin-meta";
          const fechaRegistro = new Date(registro.timestamp);
          meta.innerHTML = `Última actualización: <time datetime="${fechaRegistro.toISOString()}">${formatDateTimeForHuman(fechaRegistro)}</time>`;
          label.appendChild(meta);
        }

        item.append(checkbox, label);
        list.appendChild(item);
      });

      panel.setAttribute("aria-hidden", "false");
    }

    function getStoredPerson() {
      try {
        const stored = localStorage.getItem(SELECTED_PERSON_KEY);
        return stored || "Alberto";
      } catch (error) {
        console.warn("No se pudo recuperar la persona seleccionada", error);
        return "Alberto";
      }
    }

    function storeSelectedPerson(persona) {
      try {
        localStorage.setItem(SELECTED_PERSON_KEY, persona);
      } catch (error) {
        console.warn("No se pudo guardar la persona seleccionada", error);
      }
    }

    function updatePeopleButtons(selectedPersona) {
      document.querySelectorAll(".people-button").forEach((button) => {
        const isSelected = button.dataset.persona === selectedPersona;
        button.setAttribute("aria-selected", String(isSelected));
        button.tabIndex = isSelected ? 0 : -1;
      });
    }

    function actualizarVista() {
      const anchorInput = document.getElementById("anchor");
      const resumenSemana = document.getElementById("resumen-semana");
      const resumenFecha = document.getElementById("resumen-fecha");
      const resumenAnchor = document.getElementById("resumen-anchor");
      const resumenTarea = document.getElementById("resumen-tarea");

      let base = parseDateOrNull(anchorInput.value) || parseDateOrNull(BASE_DATE_ISO);
      if (!base) {
        base = parseDateOrNull(BASE_DATE_ISO);
      }

      const baseIso = base.toISOString().slice(0, 10);
      if (anchorInput.value !== baseIso) {
        anchorInput.value = baseIso;
      }
      storeAnchor(baseIso);

      const hoy = getToday();
      const fechaIso = hoy.toISOString().slice(0, 10);
      const semanasPasadas = semanasEntre(base, hoy);
      const idxSemana = ((semanasPasadas % 4) + 4) % 4;
      const ciclo = idxSemana + 1;

      const fechaHumana = capitalise(
        hoy.toLocaleDateString("es-ES", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric"
        })
      );

      const baseHumana = capitalise(
        base.toLocaleDateString("es-ES", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric"
        })
      );

      resumenSemana.textContent = `Semana ${ciclo} / 4`;
      resumenFecha.innerHTML = `<strong>Fecha:</strong> ${fechaHumana}`;
      resumenAnchor.innerHTML = `<strong>Semana 1 anclada:</strong> ${baseHumana} <span class="pill">${baseIso}</span>`;

      const personaSeleccionada = getStoredPerson();
      updatePeopleButtons(personaSeleccionada);

      let tarea = null;
      for (let j = 0; j < TAREAS.length; j++) {
        if (norm(CUADRANTE[idxSemana][j]) === norm(personaSeleccionada)) {
          tarea = TAREAS[j];
          break;
        }
      }

      if (tarea) {
        resumenTarea.innerHTML = `✅ A <strong>${personaSeleccionada}</strong> le corresponde: <strong>${tarea}</strong>.`;
      } else {
        resumenTarea.innerHTML = "⚠️ Selecciona a una persona para ver su tarea.";
      }

      renderCheckinPanel(idxSemana, fechaIso, baseIso, fechaHumana);
    }

    function inicializar() {
      const botones = document.querySelectorAll(".people-button");
      const anchorInput = document.getElementById("anchor");
      const anchorGuardada = getStoredAnchor();
      anchorInput.value = parseDateOrNull(anchorGuardada) ? anchorGuardada : BASE_DATE_ISO;
      const personaInicial = getStoredPerson();
      updatePeopleButtons(personaInicial);

      botones.forEach((boton) => {
        boton.addEventListener("click", () => {
          const persona = boton.dataset.persona;
          storeSelectedPerson(persona);
          updatePeopleButtons(persona);
          actualizarVista();
        });
      });

      anchorInput.addEventListener("change", () => {
        const parsed = parseDateOrNull(anchorInput.value);
        if (parsed) {
          storeAnchor(parsed.toISOString().slice(0, 10));
        }
        actualizarVista();
      });

      actualizarVista();
    }

    document.addEventListener("DOMContentLoaded", inicializar);
  </script>
</body>
</html>
</body>
</html>

